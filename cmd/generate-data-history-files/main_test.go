package main

import (
	"bytes"
	"encoding/csv"
	"strings"
	"testing"
)

func TestFilterFileByDatesInterval(t *testing.T) {
	in := csv.NewReader(strings.NewReader(`1593387180,8106.3,8106.3,8105.1,8105.1,0.12004518,9
1593387240,8105.0,8105.1,8104.5,8104.5,0.06199963,4
1593387300,8105.2,8107.9,8105.2,8107.9,0.29412518,6
1593387360,8108.3,8108.3,8107.2,8107.2,0.85862196,4
1593387420,8107.2,8107.2,8106.8,8106.8,0.027825089999999997,2
1593387480,8105.4,8106.7,8105.0,8105.0,0.2227591,5
1593387540,8106.8,8106.8,8106.8,8106.8,0.02810335,1
1593387600,8107.6,8113.0,8107.5,8113.0,0.44360731000000003,9
1593387660,8113.0,8113.0,8107.7,8107.7,0.03141301,4
1593387720,8108.9,8112.9,8108.9,8112.9,0.0409239,5
1593387780,8112.0,8112.0,8109.9,8109.9,0.04299188,3
1593387840,8107.9,8110.6,8107.9,8110.6,0.07137652,6`))
	in.LazyQuotes = true
	out := &bytes.Buffer{}

	FilterFileByDatesInterval(in, out, 1593387360, 1593387600)

	got := out.String()
	want := `1593387360,8108.3,8108.3,8107.2,8107.2,0.85862196,4
1593387420,8107.2,8107.2,8106.8,8106.8,0.027825089999999997,2
1593387480,8105.4,8106.7,8105.0,8105.0,0.2227591,5
1593387540,8106.8,8106.8,8106.8,8106.8,0.02810335,1
1593387600,8107.6,8113.0,8107.5,8113.0,0.44360731000000003,9`

	if strings.Compare(got, want) != 0 {
		t.Errorf("\ngot:\n%v\nwant:\n%v\n",
			got,
			want,
		)
	}
}
